"use strict";var e=function(e){return e&&e.__esModule?e["default"]:e},t=e(require("react")),s=e(require("../listen")),i=e(require("react/lib/cloneWithProps")),r=e(require("clamp"));module.exports=function(){return{handleSize:8,propTypes:{onLayoutResize:t.PropTypes.func},getDefaultProps:function(){return{supportedChildren:{HLayout:!0,VLayout:!0,TreeView:!0,"layout-child":!0}}},handleResize:function(){this.forceUpdate()},getInitialState:function(){var e=this.props.serialized,t=[];if(e.length>0)for(var s=0;s<e.length;s++)t[s]=e[s].size;else if(Array.isArray(this.props.children))for(var i=this.props.children.length,r=this.handleSize*(i-1),a=this.getSize()-r,s=0;i>s;s++){var n=a/i;this.props.serialized[s]={size:n,children:[]},t.push(n)}else{var n=this.getSize();this.props.serialized[0]={size:n,children:[]},t.push(n)}return{sizes:t,serialized:this.props.serialized}},componentDidMount:function(){},onMouseMove:function(e,t){t.preventDefault(),t.stopPropagation();var s=this.getEventPosition(t)-this.start,i=this.startSizes[0]+this.startSizes[1];this.state.sizes[e]=r(this.startSizes[0]+s,0,i),this.state.sizes[e+1]=r(this.startSizes[1]-s,0,i),this.state.serialized[e].size=this.state.sizes[e],this.state.serialized[e+1].size=this.state.sizes[e+1],this.props.onLayoutResize&&this.props.onLayoutResize(this.state.sizes),this.setState(this.state)},onMouseUp:function(){this.state.disposables.forEach(function(e){e.dispose()})},onHandleDown:function(e,t){var i=this;1===t.nativeEvent.which&&(t.nativeEvent.preventDefault(),this.start=this.getEventPosition(t.nativeEvent),this.startSizes=[this.state.sizes[e],this.state.sizes[e+1]],this.state.disposables=[s(document.body,"mouseup",this.onMouseUp),s(document.body,"mousemove",function(t){i.onMouseMove(e,t)})])},render:function(){for(var e=this,s=this.props.children.slice(),r=this.state.sizes.reduce(function(e,t){return e+t},0),a=this.handleSize*(s.length-1),n=(this.getSize()-a)/r,o=0;o<this.state.sizes.length;o++)this.state.sizes[o]*=n;for(var h=0,o=0;o<s.length;o++){var p=s[o],l=this.state.sizes[o];if(p&&p.type&&this.props.supportedChildren[p.type.displayName]){var u=this.getProps(l,this.props.width,this.props.height);("HLayout"===p.type.displayName||"VLayout"===p.type.displayName)&&(u.serialized=this.state.serialized[o].children),p=i(p,u)}s[o]=t.createElement("div",{key:h++,className:this.getContainerClass(),style:this.getProps(l,this.props.width,l,this.props.height)},p)}var d=[];return s.forEach(function(i,r){d.push(i),r<s.length-1&&d.push(t.createElement("div",{key:h++,className:"layout-handle",onMouseDown:function(t){e.onHandleDown(r,t)},style:e.getHandleStyle()}))}),t.createElement("div",{className:this.getLayoutClass()},d)}}};